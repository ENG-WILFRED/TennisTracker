generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Player {
  id           String    @id @default(uuid())
  username     String    @unique
  email        String    @unique
  phone        String?   @unique
  passwordHash String // for authentication
  firstName    String
  lastName     String
  photo        String? // profile picture URL
  gender       String? // optional (Male/Female/Other)
  dateOfBirth  DateTime? // useful for age categories
  nationality  String? // country/region
  bio          String? // short profile description

  // Statistics
  matchesPlayed   Int @default(0)
  matchesWon      Int @default(0)
  matchesLost     Int @default(0)

  // Relations
  playerBadges    PlayerBadge[]
  matchesA        Match[]         @relation("PlayerA")
  matchesB        Match[]         @relation("PlayerB")
  ballCrewMatches MatchBallCrew[]
  chatMessages    ChatMessage[]
  chatRooms       ChatParticipant[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  Match Match[]
  inventoryItems InventoryItem[]
  staffMembers Staff[]
  attendance Attendance[]
  performancePoints PerformancePoint[]
  isClub      Boolean   @default(false)
  // Organization membership
  organization   Organization? @relation(fields: [organizationId], references: [id])
  organizationId String?
}

model InventoryItem {
  id        String   @id @default(uuid())
  name      String
  count     Int      @default(0)
  condition String?
  club      Player?  @relation(fields: [clubId], references: [id])
  clubId    String?
  // Optional organization ownership
  organization   Organization? @relation(fields: [organizationId], references: [id])
  organizationId String?
  updatedAt DateTime @updatedAt
}

model Referee {
  id           String    @id @default(uuid())
  username     String    @unique
  email        String    @unique
  phone        String?   @unique
  passwordHash String // for authentication
  firstName    String
  lastName     String
  photo        String? // profile picture URL
  gender       String? // optional (Male/Female/Other)
  dateOfBirth  DateTime? // useful for age categories
  nationality  String? // country/region
  bio          String? // short profile description

  // Statistics
  matchesRefereed Int @default(0)
  ballCrewMatches Int @default(0)
  experience     String? // years of experience
  certifications String[] @default([]) // referee certifications

  // Relations
  refereedMatches Match[]        @relation("Referee")
  ballCrewReferees MatchBallCrew[] @relation("BallCrewReferee")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Staff {
  id                    String                    @id @default(uuid())
  name                  String
  email                 String?   @unique
  phone                 String?
  contact               String? // Contact information (email or phone preferred for display)
  photo                 String? // profile picture URL
  gender                String? // Male/Female/Other
  nationality           String? // country/region
  
  // Core coaching info
  role                  String // Head Coach, Assistant Coach, Fitness Coach, Junior Coach
  yearsOfExperience     Int? @default(0)
  expertise             String? // primary specialization
  
  // Qualifications & Credibility
  coachingLevel         String? // Beginner, Intermediate, Advanced, Professional
  formerPlayerBackground String? // bio about playing career
  certifications        Certification[]
  specializations       Specialization[]
  
  // Capabilities
  playerAgeGroups       String[] @default([]) // Kids, Teens, Adults
  skillLevelsTrained    String[] @default([]) // Beginner, Intermediate, Advanced, Professional
  trainingTypes         String[] @default([]) // Private sessions, Group sessions, Clinics, Online coaching
  languagesSpoken       String[] @default([])
  
  // Availability & Scheduling
  availability          Availability[]
  sessionDurations      Int[] @default([30, 60, 90]) // in minutes
  maxStudentsPerSession Int? @default(1)
  courtLocations        String[] @default([])
  
  // Pricing & Monetization
  pricing               CoachPricing?
  
  // Bio & Content
  bio                   String? // short bio
  coachingPhilosophy    String? // coaching philosophy
  achievements          String? // notable achievements
  introVideoUrl         String? // optional intro video
  
  // Reputation & Social Proof
  reviews               CoachReview[]
  studentCount          Int @default(0) // denormalized count
  
  // Admin/System
  isVerified            Boolean @default(false)
  isActive              Boolean @default(true)
  isDeleted             Boolean @default(false)
  ownerId               String? // User/Player who owns this coach profile
  auditLogs             AuditLog[]
  
  // Relations
  employedBy            Player?  @relation(fields: [employedById], references: [id])
  employedById          String?
  // Organization employment
  organization   Organization? @relation(fields: [organizationId], references: [id])
  organizationId String?
  
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}

// Organization model for clubs/teams
model Organization {
  id          String       @id @default(uuid())
  name        String       @unique
  slug        String?      @unique
  description String?
  address     String?
  city        String?
  country     String?
  phone       String?
  email       String?
  logo        String?      // URL to logo image
  primaryColor String?     // e.g. '#0ea5e9' or 'blue-500'
  createdBy   String?      // Player ID who created the organization

  // Relations
  players     Player[]
  staff       Staff[]
  inventory   InventoryItem[]

  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}

// Certifications
model Certification {
  id        String   @id @default(uuid())
  staffId   String
  staff     Staff    @relation(fields: [staffId], references: [id], onDelete: Cascade)
  name      String   // ITF, ATP, WTA, National federation, etc.
  issuer    String? // Organization that issued it
  issuedAt  DateTime?
  expiresAt DateTime?
  createdAt DateTime @default(now())
  
  @@unique([staffId, name])
}

// Specializations
model Specialization {
  id        String   @id @default(uuid())
  staffId   String
  staff     Staff    @relation(fields: [staffId], references: [id], onDelete: Cascade)
  name      String   // Singles, Doubles, Juniors, High-performance, Fitness, Injury recovery
  level     String? // Beginner, Intermediate, Advanced
  yearsOfFocus Int? // years focused on this specialization
  createdAt DateTime @default(now())
  
  @@unique([staffId, name])
}

// Weekly Availability
model Availability {
  id        String   @id @default(uuid())
  staffId   String
  staff     Staff    @relation(fields: [staffId], references: [id], onDelete: Cascade)
  dayOfWeek Int      // 0=Monday, 1=Tuesday, ..., 6=Sunday
  startTime String   // HH:MM format (24-hour)
  endTime   String   // HH:MM format (24-hour)
  createdAt DateTime @default(now())
  
  @@unique([staffId, dayOfWeek, startTime])
}

// Pricing
model CoachPricing {
  id                 String   @id @default(uuid())
  staffId            String   @unique
  staff              Staff    @relation(fields: [staffId], references: [id], onDelete: Cascade)
  pricePerSession    Float    // base price
  currency           String   @default("USD")
  
  // Package pricing
  package3Sessions   Float?   // 3-session package price
  package10Sessions  Float?   // 10-session package price
  
  // Discounts
  juniorDiscount     Float? @default(0) // percentage discount
  groupSessionDiscount Float? @default(0) // percentage discount
  
  // Commission (if marketplace)
  commissionRate     Float? @default(0) // percentage
  
  paymentMethods     String[] @default(["credit_card", "bank_transfer"]) // supported payment methods
  
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

// Reviews & Ratings
model CoachReview {
  id           String   @id @default(uuid())
  staffId      String
  staff        Staff    @relation(fields: [staffId], references: [id], onDelete: Cascade)
  playerId     String   // student who reviewed
  rating       Float    // 1-5 rating
  reviewText   String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  @@unique([staffId, playerId])
}

// Audit Logs for admin/system changes
model AuditLog {
  id        String   @id @default(uuid())
  staffId   String
  staff     Staff    @relation(fields: [staffId], references: [id], onDelete: Cascade)
  action    String   // Created, Updated, Verified, Deleted, etc.
  field     String?  // which field was changed
  oldValue  String?  // previous value
  newValue  String?  // new value
  performedBy String? // User who performed action
  createdAt DateTime @default(now())
}


model Match {
  id        String          @id @default(uuid())
  round     Int
  playerA   Player          @relation("PlayerA", fields: [playerAId], references: [id])
  playerAId String
  playerB   Player          @relation("PlayerB", fields: [playerBId], references: [id])
  playerBId String
  referee   Referee?        @relation("Referee", fields: [refereeId], references: [id])
  refereeId String?
  ballCrew  MatchBallCrew[]
  winner    Player?         @relation(fields: [winnerId], references: [id])
  winnerId  String?
  group     String?
  score     String?
  createdAt DateTime        @default(now())
}

model MatchBallCrew {
  id       String  @id @default(uuid())
  match    Match   @relation(fields: [matchId], references: [id])
  matchId  String
  player   Player  @relation(fields: [playerId], references: [id])
  playerId String
  ballCrewReferee Referee? @relation("BallCrewReferee", fields: [refereeId], references: [id])
  refereeId String?
}

model Badge {
  id           String        @id @default(uuid())
  name         String
  description  String
  category     String // e.g. "Wins", "Referee", "Participation"
  icon         String? // optional icon/image URL
  playerBadges PlayerBadge[]
}

model PlayerBadge {
  id       String   @id @default(uuid())
  player   Player   @relation(fields: [playerId], references: [id])
  playerId String
  badge    Badge    @relation(fields: [badgeId], references: [id])
  badgeId  String
  earnedAt DateTime @default(now())
}

// Analytics models: attendance records and per-player performance points
model Attendance {
  id       String   @id @default(uuid())
  player   Player   @relation(fields: [playerId], references: [id])
  playerId String
  date     DateTime
  present  Boolean  @default(true)
  createdAt DateTime @default(now())
}

model PerformancePoint {
  id       String   @id @default(uuid())
  player   Player   @relation(fields: [playerId], references: [id])
  playerId String
  date     DateTime
  rating   Float
  points   Int
  createdAt DateTime @default(now())
}

model TennisRule {
  id        String   @id @default(uuid())
  category  String   // Scoring, Basic Rules, Court & Equipment, Key Violations
  label     String   // display label
  value     String?  // description or value
  createdAt DateTime @default(now())

  @@unique([category, label])
}

// Chat Models
model ChatRoom {
  id           String   @id @default(uuid())
  name         String
  description  String?
  isPrivate    Boolean  @default(false)
  createdBy    String   // Player ID who created the room
  messages     ChatMessage[]
  participants ChatParticipant[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model ChatMessage {
  id        String   @id @default(uuid())
  roomId    String
  room      ChatRoom @relation(fields: [roomId], references: [id], onDelete: Cascade)
  playerId  String   // Player who sent the message
  player    Player   @relation(fields: [playerId], references: [id])
  content   String
  createdAt DateTime @default(now())
}

model ChatParticipant {
  id        String   @id @default(uuid())
  roomId    String
  room      ChatRoom @relation(fields: [roomId], references: [id], onDelete: Cascade)
  playerId  String
  player    Player   @relation(fields: [playerId], references: [id])
  isOnline  Boolean  @default(false)
  lastSeen  DateTime @default(now())
  createdAt DateTime @default(now())

  @@unique([roomId, playerId])
}

